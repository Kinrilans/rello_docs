# Диалоговые флоу — @ClubGateBot (v2)

## 0) Контекст
Единая точка входа. Онбординг по инвайтам, профили компаний/пользователей, шаблоны реквизитов (банк/крипто), каталог партнёров, **доверительные пары** и общий Inbox уведомлений. Переходы в профильные боты через deeplink `start=<short‑token>` с восстановлением контекста (company/role/опционально partner_id/trust_session_id).

---

## 1) /start → инвайт, правила и 2FA
**Цель:** впустить участника в клуб и привязать к компании.

**Шаги**
1. `/start` → выбор языка → TL;DR правил клуба → поле **инвайт‑кода**.
2. Валидация инвайта (не просрочен/не исчерпан, доступна роль) → привязка Telegram‑ID → предложение включить **2FA**.
3. Экран «Готово»: кнопки **Профиль**, **Моя компания**, **Каталог**, **Доверительные пары**, **Inbox**.

**Ошибки/подсказки**
- «Инвайт недействителен/просрочен/исчерпан».
- «Аккаунт уже привязан к компании <X>» → кнопка **Поддержка**.
- «Включите 2FA перед доступом к чувствительным действиям».

---

## 2) /invite — инвайты (Company Admin)
**Цель:** выдавать и управлять кодами приглашений.

**Шаги**
1. Список активных кодов: роль по умолчанию, лимит использований, истечение.
2. Кнопки: **Создать**, **Отключить**, **Скопировать**.
3. При создании — карточка инвайта + **Поделиться**.

**Ошибки**
- «Достигнут лимит инвайтов для компании».

---

## 3) /members — участники компании (Company Admin)
**Цель:** управлять ролями и безопасностью.

**Шаги**
1. Список: имя, роли, статус, 2FA.
2. Действия: **Изменить роли**, **Отключить доступ**, **Сброс 2FA**, **Пригласить по ссылке**.

---

## 4) /company — профиль компании (Company Admin)
**Цель:** основные данные, tier/лимиты, видимость в каталоге.

**Шаги**
1. Карточка: название, tier, k‑factor, лимиты, рабочие часы, заметка.
2. Кнопки: **Редактировать**, **Видимость в каталоге — вкл/выкл**, **Связанные боты**.

---

## 5) Реквизиты: /accounts и /wallets (Company Admin, Trader)
**Цель:** хранить шаблоны банковских счетов и крипто‑адресов; быстро делиться ими в сделках.

**/accounts**: список счетов (валюта, банк, IBAN/номер, метка, «по умолчанию») → **Добавить/Редактировать/Удалить/Поделиться**.

**/wallets**: адреса по сетям (ERC‑20/TRC‑20) и токенам (USDT/USDC), статус **верификации** (подпись/микро‑tx) → **Добавить/Верифицировать/Удалить/Поделиться**.

**Ошибки/подсказки**: «Адрес не верифицирован — подтвердите владение», «Дубликат адреса/счёта».

---

## 6) /partners и /partner <id> — каталог партнёров
**Цель:** найти контрагента и инициировать сделку или доверительную пару.

**/partners**: фильтры (сеть, токен, объёмы, tier, рабочие часы, рейтинг), карточки: название, объёмы 30/90d, сети/токены, **бейдж «Доверительный партнёр»**, кнопки **Профиль**, **Запросить сделку**, **Запросить доверие**.

**/partner <id>**: профиль с параметрами + кнопки **Запросить сделку** (deeplink в @DealDeskBot) и **Запросить доверие** (см. ниже).

---

## 7) Доверительные пары (новое)
**Команды**
- `/trust_pairs` (Company Admin): список пар **A↔B**, статус (active/paused/proposed), **дневной лимит**, **резерв %**, **cut‑off** (например, 18:00), **часовой пояс** пары, поддерживаемые **токены/сети**. Кнопки: **Создать**, **Пауза/Возобновить**, **Изменить**.
- `/trust_partner <id>` (Company Admin): карточка пары с формой параметров → **Запросить доверие** / **Принять запрос**.

**Параметры пары**
- Токены/сети: USDT/USDC × ERC‑20/TRC‑20 (обе по умолчанию).
- Дневной кредит‑лимит (USD экв.; не выше min(лимит A, лимит B, cap платформы)).
- Резерв % (опц.) — удержание части депозита.
- Часовой пояс пары (IANA) и **EOD cut‑off** (HH:MM).
- Режим по умолчанию: **включать «Неттинг в EOD»** для сделок A↔B.

**Проверки/ограничения**
- Доступ только при **активном депозите** у обеих компаний.
- Автопауза неттинга при достижении 90% дневного лимита пары.
- Изменение параметров пары действует **со следующей дневной сессии**.

---

## 8) Inbox уведомлений
**Цель:** единый центр событий: офферы/сделки/выплаты/споры/EOD.

**Флоу**
1. `/inbox` → лента: «Новый оффер», «Статус сделки», «Выплата отправлена», «Открыт спор», **«EOD через 60/15/5 мин по A↔B»**, **«EOD расчёт выполнен/частичный/ошибка»**.
2. Карточки с CTA: **Открыть @DealDeskBot**, **Открыть @TreasuryBot**, **Открыть @ArbiterDeskBot**.
3. Фильтры: Все / Сделки / Платежи / Споры / **EOD**. Кнопки **Прочитано**, **Mute**.

---

## 9) /help, /rules, /faq — справка и правила
- `/help` — список команд, быстрые ссылки в профильные боты.
- `/rules` — TL;DR + кнопка **Полный текст** (Правила арбитража v1 с разделом про trust‑session).
- `/faq` — ответы: лимиты, сети, дедлайны, неттинг, споры, комиссии.

---

## 10) Ошибки/ограничения
- «Нет доступа: требуется роль Company Admin/Approver».
- «Включите 2FA для доступа к разделу».
- «У вашей компании нет активного депозита — доверительные пары недоступны».
- «Партнёр без активного депозита — запрос доверия невозможен».

---

## 11) Переходы в другие боты
- Из карточек профиля/каталога/Inbox: **Открыть в …** (DealDesk/Treasury/Arbiter).
- Передаём `start=<short‑token>`; бэкенд валидирует и поднимает контекст (company/role/partner_id/опц. trust_session_id).

---

## 12) Логи/аудит
- Все критичные действия (создание/изменение/пауза доверительных пар, инвайты, роли, верификация адресов) пишутся в `audit_log`.
- Отправка шаблонов реквизитов в сделки — журналируется (какой шаблон, какой deal_id, кем).

---

## 13) Метрики/телеметрия
- Кол-во активных доверительных пар, средний дневной лимит, % загрузки лимитов, число EOD‑уведомлений, клики в CTA, конверсия запросов доверия → активные пары.

