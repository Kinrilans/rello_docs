# @RelloClubBot — Главный кабинет клиента (полный флоу)

> Полная спецификация основного клиентского бота. Структура и правила идентичны админ‑докам: для каждого экрана указан **Режим вывода** (*Новое сообщение / Редактирование / Системное уведомление*), вынесены **переменные**, действует **правило актуальности** (удаляем старые экраны после успешных действий).

---

## 0) Общие положения

### Назначение

Личный кабинет клиента Rello: регистрация/восстановление, главное меню, поиск партнёров, офис (услуги, работники, направление сделок), кошелёк (RC и депозит), реферальная программа, объявления/модерация, работа в чат‑группах, переписка, профиль, удаление аккаунта, язык.

### Контроль доступа

- При входе проверяем наличие пользователя в системе.
- Регистрация — по одноразовому **токену нового владельца сервиса**.
- Восстановление — по **токену восстановления**.

### Типы интерфейсов

- **Сообщение** — обычный текст (может редактироваться).
- **Системное уведомление** — `answerCallbackQuery` без нового сообщения.
- **Ожидаемый ввод** — бот ожидает ввод текста/файла. Если не требуется — «—».

### Политика вывода сообщений (дефолт)

- Команды верхнего уровня (`/start`, `/menu`, `/info`) → **Новое сообщение**.
- Навигация по разделам → **Редактирование** текущего сообщения.
- Подтверждения/переключатели → **Системное уведомление** (если не требуется новый экран).
- Результаты с файлами (CSV, docs) → **Новое сообщение** с файлом.
- Формы (ввод + валидация) → **Редактирование** той же формы.

### Правило актуальности сообщений и кнопок

- **После УСПЕШНОГО ввода/подтверждения**: **удаляем** прежний экран с кнопками (`deleteMessage`) и **присылаем новое** сообщение с актуальным состоянием.
- Если удаление **невозможно** — **снимаем клавиатуру** и на нажатия по старым кнопкам отвечаем «Уже не актуально» (`answerCallbackQuery`).
- Ошибки валидации («ввод некорректен») показываем **без удаления** (ждём новый ввод). Очистка — только после успеха.
- Рекомендация: в `callback_data` хранить **версию/токен состояния экрана**.

### Динамические переменные

**Профиль/дашборд:**

- `{nickname}` — ник клиента; `{service_name}` — имя сервиса
- `{rating}` — рейтинг (напр. `4.9`)
- `{active_services_count}` — активные услуги; `{active_deals_count}` — активные сделки

**Кошелёк/балансы:**

- `{deposit_tier}` — S/A/B/C/D
- `{deposit_usdt}` — сумма депозита, USDT
- `{rc_balance}` — баланс RC; `{rc_frozen}` — заморожено RC
- `{available_to_withdraw_rc}` — доступно к выводу RC
- `{rc_withdraw_fee_rc}` — комиссия вывода RC (в RC)

**Rello‑коины (пополнение/вывод):**

- `{rc_topup_min}` — минималка пополнения RC (напр. `100`)
- `{rc_rate}` — курс RC к USDT (обычно 1)
- `{rc_request_id}`, `{opened_at}`
- `{rc_amount}` — сумма в RC; `{rc_fee}` — комиссия в RC
- `{rc_amount_payable_usdtx}` — к оплате USDT/USDC
- `{token_choice}` — `USDT`/`USDC`
- `{trc20_address}` — адрес клиента / служебный
- `{payment_timeout_hours}` — таймаут оплаты (обычно `24`)
- `{blockchain_tx_link}` — ссылка на транзакцию

**Депозит (пополнение/вывод):**

- `{bail_request_id}`
- `{bail_amount_usdt}`, `{bail_fee_usdt}`
- `{bail_amount_payable_usdt}` (пополнение) / `{bail_amount_to_send_usdt}` (вывод)
- `{bail_address}` — адрес клиента TRC20
- `{bail_tx_link}` — ссылка на транзакцию
- `{bail_withdraw_fee_percent}` — комиссия вывода депозита, % (напр. `0.5`)
- `{bail_withdraw_sla}` — срок вывода, нап., `7 рабочих дней`

**Реферальная программа:**

- `{ref_invited_total}` — приведено клиентов
- `{ref_earned_total_rc}` — заработано всего RC
- `{ref_next_payout_rc}` — получит в начале месяца RC
- `{ref_invites_left}` — остаток приглашений в месяце
- `{ref_history_csv}` — имя файла CSV

**Объявления:**

- `{ads_active_count}`, `{ads_inactive_count}`, `{ads_moderation_count}`
- `{ad_id}`, `{ad_title}`, `{ad_description}`
- `{ad_b2c_percent}`, `{ad_c2b_percent}`
- `{ad_allowed_clients}` — «Все»/«Только с депозитом»/конкретный тир
- `{ad_deal_types}` — «Одиночные/Чат‑группы/Все»
- `{ad_currencies}` — ISO 4217 список, через запятую
- `{ad_is_active}` — булево; `{ad_link}` — ссылка на пост в теме
- `{ads_update_cooldown_min}` — 10 минут; `{ads_bump_cooldown_h}` — 24 часа

**Работники/группы:**

- `{workers_count}`; `{deal_direction}` — «Рабочая группа»/«Личные сообщения»
- `{group_count}`; `{group_name}`; `{group_b2c_percent}`, `{group_c2b_percent}`
- `{group_token}` — токен регистрации группы; `{group_token_ttl_hours}` — 2 часа
- `{token_rate_limit}` — лимит генерации токенов (2/мин)

**История/файлы CSV:**

- `{history_csv_filename}` — имя выгрузки с датами
- `{period_months}` — 1/6/12

**Язык/прочее:**

- `{current_language}` — «Русский»/«English»

---

## 1) Вход, регистрация, восстановление `/start`

### 1.1. Пользователь найден

**Текст**

```
Добро пожаловать, рады снова вас видеть {nickname}
```

**Кнопки:** —\
**Ожидаемый ввод:** —\
**Режим вывода:** Новое сообщение → затем показываем меню

### 1.2. Пользователя нет — регистрация

**Текст**

```
Это закрытый клуб Rello, вход только для новых членов клуба, пожалуйста введите токен регистрации.
```

**Кнопки:** `Восстановить доступ`\
**Ожидаемый ввод:** Токен нового владельца сервиса\
**Режим вывода:** Новое сообщение

#### 1.2.1. Проверка токена

- Неверный → **Новое сообщение**

```
Токен не найден или не действителен, запросите новый токен
```

- Верный → регистрируем, **удаляем** предыдущее и шлём **новое**:

```
Регистрация прошла успешно
Напишите название вашего сервиса до 20 символов
```

**Ожидаемый ввод:** Название ≤ 20 символов\
**Режим вывода:** Удаление + Новое сообщение

#### 1.2.2. Ввод названия

-
  > 20 символов → сообщение об ошибке «Название превышает лимит…» *(Редактирование)*
- Валидно → **Удаляем** старое и шлём **новые**:
  1. **Инструкции по запуску** (боты, группа с темами, работа вне сервиса, рефералка, ссылки/правила);
  2. **Токен восстановления**:

```
Ваш токен восстановления на случай утраты доступа к Telegram.
Токен: <сгенерированный токен>
```

3. **Главное меню** (см. раздел 2).\
   **Режим вывода:** Новые сообщения подряд (3 шт.)

### 1.3. Восстановить доступ (кнопка)

Редактируем текущий экран на:

```
Для восстановления введите токен, выданный при регистрации
```

**Кнопки:** `Назад`\
**Ожидаемый ввод:** Токен восстановления\
**Режим вывода:** Редактирование

#### 1.3.1. Проверка токена восстановления

- Неверный → сообщение «Токен не найден или не действителен…» *(Новое сообщение))*
- Верный → **Удаляем** старое и шлём **новое**:

```
Восстановление прошло успешно
С возвращением в клуб! В целях безопасности мы ограничиваем вывод средств и совершение сделок на 24 часа, объявления временно неактивны.
```

Далее: обновить Telegram‑ID пользователя, блок на 24 часа, деактивация объявлений, стоп заявок на ввод/вывод, сделки могут закрыть администраторы. В соответствующих пунктах — системное уведомление: «В мерах безопасности вы заблокированы на 24 часа». Затем — **Главное меню**.\
**Режим вывода:** Удаление + Новое сообщение

---

## 2) Меню `/menu`

**Текст**

```
Главное меню

Кошелёк: {rc_balance} RC
Рейтинг: {rating}
Активные услуги: {active_services_count}
Активные сделки: {active_deals_count}
```

**Кнопки:** `Кошелёк` / `Найти партнёров` / `Мой офис` / `Реф. программа` / `Профиль` / `Инфо`\
**Ожидаемый ввод:** —\
**Режим вывода:** Новое сообщение (по команде), далее — Редактирование

**Найти партнёров** — открывает группу/канал с объявлениями (внешняя ссылка).\
**Режим вывода:** Системное уведомление (или внешнее открытие)

---

## 3) Инфо `/info`

**Текст**

```
Rello Club — закрытый клуб для работы по крипто‑услугам.
@RelloClubBot — ваш кабинет: услуги, комиссии, кошелёк, депозит и др.
@RelloDealBot — одиночные сделки сервиса.
@RelloNoticeBot — уведомления по сделкам и важным событиям.
Группа с темами — чтобы найти партнёров.

Ознакомьтесь с правилами и политиками сервиса (ссылка).
```

**Кнопки:** —\
**Режим вывода:** Новое сообщение

---

## 4) Мой офис `/office`

**Текст**

```
Активные услуги: {active_services_count}
Открытые сделки: {active_deals_count}
Завершённых сделок: …
Для работы со сделками перейдите в @RelloDealBot или в рабочую группу с ним.
Работники: {workers_count}
```

**Кнопки:** `Мои услуги` / `Работа вне сервиса` / `Мои работники`\
**Режим вывода:** Редактирование

### 4.1. Мои работники

**Текст**

```
Работники: {workers_count}
Куда идут сделки: {deal_direction}

Вы можете добавить работников, которые будут обрабатывать сделки.
Для регистрации:
— создайте рабочую группу;
— добавьте @RelloDealBot, выдайте права администратора и запустите;
— попросите работников ввести /registr (привязка к вашему сервису).

Вы можете менять направление сделок: в группу или в ЛС.
```

**Кнопки:** `Назад` / `Направление сделок` / `Удалить работника`\
**Режим вывода:** Редактирование

#### 4.1.1. Удалить работника

- Экран выбора:

```
Выберите работника, которого хотите удалить
```

**Кнопки:** `Назад` / Список `@nickname` (пагинация)\
Выбор ника → подтверждение:

```
Вы действительно хотите удалить {nickname}?
```

**Кнопки:** `Назад` / `Да, удалить`\
`Да, удалить` → снимаем права в @RelloDealBot, сообщение:

```
Работник {nickname} удалён, удалите его из рабочей группы.
```

Далее — возвращаем список работников.\
**Режим вывода:** Редактирование

#### 4.1.2. Направление сделок

```
Выберите, куда направлять новые сделки:
— В рабочую группу
— В личные сообщения
```

**Кнопки:** `Назад` / `Рабочая группа` / `В личные сообщения`

- `Рабочая группа` → если группы нет — **Системное уведомление** «Рабочая группа отсутствует»; иначе применяем и → **Системное уведомление** «Изменения сохранены».
- `В личные сообщения` → применяем и → **Системное уведомление** «Изменения сохранены».

---

## 5) Кошелёк `/wallet`

**Текст**

```
Кошелёк
Ваш депозит {deposit_tier}: {deposit_usdt} USDT
Rello коины: {rc_balance} RC
Заморожено: {rc_frozen} RC
```

**Кнопки:** `Назад` / `Rello коины` / `Депозит` / `Заявки`\
**Режим вывода:** Редактирование

### 5.1. Заявки

```
Открытые заявки: …
```

**Кнопки:** `Назад` / `Активные заявки` / `История заявок`\
**Режим вывода:** Редактирование

- **Активные заявки** → выбор: `Заявки по депозиту` / `Заявки по Rello‑койнам` → список (пагинация) → открыть карточку заявки на актуальном этапе.
- **История заявок** → «Сформировать CSV: Месяц / Полгода / Год» → формируем файл `{history_csv_filename}` и отправляем.\
  **Режим вывода:** Новое сообщение (с файлом)

---

## 6) Rello‑коины `/rcoins`

**Текст** (аналог блока из кошелька)

```
Кошелёк
Ваш депозит {deposit_tier}: {deposit_usdt} USDT
Rello коины: {rc_balance} RC
Заморожено: {rc_frozen} RC
```

**Кнопки:** `Назад` / `Пополнить` / `Вывести`\
**Режим вывода:** Редактирование

### 6.1. Пополнить

Экран ввода суммы:

```
Покупка Rello‑коинов
Текущий баланс: {rc_balance} RC
Минимальное пополнение: {rc_topup_min} RC
Курс: 1 RC = {rc_rate} USDT

Напишите сумму пополнения
```

**Кнопки:** `Назад`\
**Ожидаемый ввод:** Сумма (целое число)\
**Валидация:** ≥ `{rc_topup_min}`, целое число. — Ошибка минимума → «Минимальная сумма {rc\_topup\_min} RC» *(Редактирование)*\
— Ошибка формата → «Сумма введена некорректно, укажите целое число» *(Редактирование)*\
— Успех → **Удаление + Новое сообщение** выбора токена: `USDT / USDC / Отмена`.

#### 6.1.1. Отмена

```
Пополнение отменено
```

**Режим вывода:** Редактирование

#### 6.1.2. Выбор токена (`USDT`/`USDC`)

Показываем расчёт и подтверждение:

```
Вы покупаете {rc_amount} RC
К оплате: {rc_amount_payable_usdtx} {token_choice}
Подтвердить пополнение?
```

**Кнопки:** `Назад` / `Подтвердить`\
`Подтвердить` → создаём заявку #{rc\_request\_id}, карточка:

```
Пополнение средств
Заявка #{rc_request_id}
Дата открытия: {opened_at}
Сумма: {rc_amount} RC
Комиссия: {rc_fee} RC
К оплате: {rc_amount_payable_usdtx} {token_choice}
```

**Кнопки:** `Написать администратору`\
**Режим вывода:** Редактирование

##### Автоматический режим

Финансовое ядро выдаёт кошелёк:

```
Кошелёк для оплаты: {trc20_address}
Отправьте точную сумму для отслеживания транзакции.
Если заявка не будет оплачена в течение {payment_timeout_hours} часов — она будет отменена.
```

- Нет оплаты в срок → сообщение «Ваша заявка #{rc\_request\_id} отменена из‑за истекшего срока!» *(Новое сообщение)*
- AML высокий риск → возврат (с вычетом комиссии), сообщение с результатом AML *(Новое сообщение)*
- AML ок → начисляем RC, сообщение об успехе «Зачислено … RC; Баланс … RC» *(Новое сообщение)*; уведомление в @RelloNoticeBot

##### Ручной режим (через @RelloAdminBot)

- Админ отменил → сообщение «Заявка отменена, причина: …» *(Новое сообщение)*
- Админ подтвердил → выдаём кошелёк для оплаты (как в авт. режиме).\
  Кнопка **«Подтвердить оплату»** (со стороны клиента) → помечаем «Ожидайте подтверждения админа», убираем кнопки. Далее админ либо отменяет (сообщение клиенту), либо подтверждает (начисляем RC; уведомление в @RelloNoticeBot).

### 6.2. Вывести

Экран ввода суммы:

```
Доступно к выводу: {available_to_withdraw_rc} RC
Комиссия: {rc_withdraw_fee_rc} RC
Введите сумму вывода
```

**Ожидаемый ввод:** Сумма\
**Валидация:** целое число; не больше доступного.\
— Ошибка формата → «Сумма введена некорректно…» *(****Новое сообщение****)*\
— Превышает баланс → «Максимальная сумма {available\_to\_withdraw\_rc} RC. Комиссия: {rc\_withdraw\_fee\_rc} RC» (*Новое сообщение)*\
— Успех → **Удаление + Новое сообщение** выбора токена `USDT/USDC/Отмена`.

Выбор токена → запрос TRC20‑адреса; валидация адреса:

- Некорректно → «Кошелёк введён неверно, … TRC20» *(****Новое сообщение****)*
- Корректно → **Удаление + Новое сообщение** подтверждения:

```
Сумма вывода: {rc_amount} RC
Комиссия: {rc_withdraw_fee_rc} RC
Вы получите: … {token_choice} TRC20
На кошелёк: {trc20_address}
```

**Кнопки:** `Назад` / `Подтвердить`\
`Подтвердить` → создаём заявку, замораживаем сумму; карточка заявки, кнопка «Написать администратору».\
**Авто‑вывод** → либо ошибка (разморозить, сообщить), либо успех с ссылкой на блокчейн; уведомление в @RelloNoticeBot.\
**Режим вывода:** Редактирование → Новое сообщение (результат)

---

## 7) Депозит `/bail`

**Текст** (из кошелька):

```
Ваш депозит {deposit_tier}: {deposit_usdt} USDT
Rello коины: {rc_balance} RC
Заморожено: {rc_frozen} RC
```

**Кнопки:** `Назад` / `Пополнить` / `Вывести`\
**Режим вывода:** Редактирование

### 7.1. Пополнить

Экран ввода суммы (мин. `100 USDT`, если задан):

- Ошибка минимума → «Минимальная сумма пополнения 100 USDT» *(****Новое сообщение****)*
- Ошибка формата → «Сумма введена некорректно» *(****Новое сообщение****)*
- Валидно → создаём заявку #{bail\_request\_id}, **Удаление + Новое сообщение** карточки:

```
Пополнение депозита
Заявка #{bail_request_id}
Дата открытия: {opened_at}
Сумма: {bail_amount_usdt} USDT
Комиссия: {bail_fee_usdt} USDT
К оплате: {bail_amount_payable_usdt} USDT
```

Ждём обработки администратором. После обработки админом присылаем реквизиты и кнопку `Оплата произведена`.

`Оплата произведена` → просим ссылку на блокчейн; — Не ссылка → «Пришлите именно ссылку» *(****Новое сообщение****)* — Ссылка валидна → **Удаление + Новое сообщение** «Ожидайте подтверждения менеджера» + кнопка `Написать администратору`.\
Решение админа: — Отказ → уведомление в @RelloNoticeBot «Отказ: (комментарий)»\
— Подтверждение → начисление депозита и уведомление «Пополнено».

### 7.2. Вывести

Экран ввод суммы:

- Ошибка минимума → «Минимальная сумма вывода 100 USDT» *(Редактирование)*
- Ошибка формата → «Сумма введена некорректно» *(Редактирование)*
- Валидно → **Удаление + Новое сообщение** запроса адреса TRC20.\
  Ввод адреса: — Ошибка → «Крипто‑адрес введён некорректно… TRC20» *(Редактирование)*\
  — Валидно → **Удаление + Новое сообщение** подтверждения:

```
Заявка на вывод депозита
Сумма вывода: {bail_amount_usdt} USDT
Комиссия: {bail_fee_usdt} USDT ({bail_withdraw_fee_percent}%)
На адрес: {bail_address}
Поступит: {bail_amount_to_send_usdt} USDT
```

**Кнопки:** `Подтвердить` / `Назад`\
`Подтвердить` → создаём заявку, отправляем в обработку; сообщение ожидания на `{bail_withdraw_sla}`; далее: — Подтверждена → уведомление «Выполнено, ссылка: {bail\_tx\_link}» в @RelloNoticeBot\
— Отклонена → уведомление «Отклонена: (комментарий)» в @RelloNoticeBot

---

## 8) Реферальная программа `/referal`

**Текст**

```
Приведено клиентов: {ref_invited_total}
Заработано всего: {ref_earned_total_rc} RC
Вы получите в начале месяца: {ref_next_payout_rc} RC
Осталось приглашений (обновляется раз в месяц): {ref_invites_left}

Выплаты — в начале месяца в RC.
```

**Кнопки:** `Назад` / `Пригласить участников` / `История выплат` / `Узнать больше`\
**Режим вывода:** Редактирование

### 8.1. Узнать больше

Показываем ссылку на PDF‑презентацию.\
**Режим вывода:** Редактирование

### 8.2. Пригласить участников

```
Вы можете сформировать одноразовый токен для приглашения 1 клиента…
```

**Кнопки:** `Назад` / `Сформировать токен`\
Проверяем лимит приглашений:

- Нет токенов → экран с кнопкой `Написать администратору` (@RelloSupport)
- Есть токены → формируем токен, отправляем:

```
Ваш одноразовый токен: <…>
Он будет активен в течение 1 часа.
```

События: истёк → сообщение «токен истёк…»; использован → «зарегистрирован новый клиент {nickname}…».\
**Режим вывода:** Новое сообщение

### 8.3. История выплат

- Если нет выплат → «У вас пока не было ни одной выплаты» *(****Новое сообщение****)*
- Если есть → кнопки `Месяц/Полгода/Год` → формируем `{ref_history_csv}` и отправляем. *(Новое сообщение)*

---

## 9) Услуги сервиса `/ads`

**Текст**

```
Активные услуги: {ads_active_count}
Неактивные услуги: {ads_inactive_count}
На модерации: {ads_moderation_count}
Разместите объявление с вашими услугами…
```

**Кнопки:** `Назад` / `Добавить услугу` / *(Список объявлений, пагинация по 10: сначала активные, затем неактивные)*\
**Режим вывода:** Редактирование

### 9.1. Добавить услугу `/addads`

Экран выбора типа:

```
Выберите тип услуги
```

**Кнопки:** `Назад` / `B2C|C2B крипто обмен` / `Продажа услуг (скоро)`\
«Продажа услуг» → **Системное уведомление** «В разработке».

#### 9.1.1. B2C|C2B крипто обмен — мастер создания

1. Название ≤ 40 символов (ошибка при превышении) → при успехе **Удаление + Новое сообщение** для **Описание ≤ 2000** (ошибка при превышении).
2. Процент B2C от 0 до 100 (ошибка вне диапазона) → **Удаление + Новое** для процента C2B.
3. Доступ «Все клиенты» / «Только с депозитом» (в последнем — выбор тира).
4. Типы сделок: `Только одиночные` / `Только в чат‑группах` / `Оба типа`.
5. Валюты ISO 4217 через запятую (парсинг + валидация; при ошибках — сообщение с найденными/неопознанными).\
   После сбора — превью объявления и кнопки `Подтвердить` / `Начать заново`.

`Подтвердить` → сохраняем как **НЕАКТИВНОЕ**, отправляем на модерацию админам; клиенту — сообщение об отправке на модерацию и напоминание про «Диапазон сделок».\
Модерация:

- Одобрено → публикуем в теме через @RelloTopicsBot, уведомление клиенту в @RelloNoticeBot с ссылкой.
- Отказ → уведомление клиенту с комментарием модератора.

### 9.2. Карточка объявления

**Текст**

```
{ad_title}
{ad_description}
Комиссии: B2C {ad_b2c_percent}% | C2B {ad_c2b_percent}%
Для клиентов: {ad_allowed_clients}
Тип сделок: {ad_deal_types}
Валюты: {ad_currencies}
Статус: {ad_is_active ? 'Активно' : 'Неактивно'}
Ссылка: {ad_link}
```

**Кнопки:** `Назад` / `Поднять объявление` / `Активировать/Деактивировать` / `Редактировать` / `Диапазон сделок` / `Удалить`

#### 9.2.1. Удалить

Подтверждение удаления; проверяем открытые сделки.\
— Есть открытые → **Системное уведомление** «По объявлению открыты сделки…»\
— Нет → удаляем пост в теме через @RelloTopicsBot, сообщение «Объявление удалено». *(Редактирование)*

#### 9.2.2. Поднять объявление

Если < `{ads_bump_cooldown_h}` часов с прошлого поднятия → **Системное уведомление** с остатком времени. Иначе — обновляем пост (удаляем старый / создаём новый) через @RelloTopicsBot, уведомление «Объявление успешно поднято».\
**Режим вывода:** Системное уведомление

#### 9.2.3. Активировать/Деактивировать

Таймаут `{ads_update_cooldown_min}` минут. Если модерация активна — «На модерации». При активации — добавить кнопки в теме; при деактивации — убрать. Уведомление об успехе.\
**Режим вывода:** Системное уведомление

#### 9.2.4. Редактировать `/editads<id>`

Локальная форма изменений (название/описание/изображение/проценты/доступ/типы/диапазон). Сохранение частями с подтверждением.

- Изображение: только `.jpg`, 1080×400, ≤200 КБ, отправкой как файл. Несоответствие → экран с правилами.
- «Обновить объявление»: если изменялись **визуальные** поля (название/описание/изображение) — на модерацию (по итогам — публикация/отказ через @RelloNoticeBot). Если только **параметры** (проценты/доступ/типы) — cooldown `{ads_update_cooldown_min}` минут и мгновенное обновление через @RelloTopicsBot.
- «Сбросить изменения» — удаляет локальные черновые правки, уведомление «Изменения сброшены».

#### 9.2.5. Диапазон сделок

Ввод в формате `MIN-MAX` без пробелов. Ошибки — сообщение; успех — **Удаление + Новое сообщение**: «Изменения сохранены» → затем карточка диапазона.

---

## 10) Работа в чат‑группах `/outjob`

**Текст**

```
Управление группами
Всего групп: {group_count}
Работа в группах — это сделки за RC с зарегистрированными и не зарегистрированными клиентами.
```

**Кнопки:** `Назад` / `Новая группа` / `Мои группы` / `Комиссии по умолчанию`\
**Режим вывода:** Редактирование

### 10.1. Комиссии по умолчанию

Показываем B2C/C2B (например, 15%/15%). Кнопки «Изменить B2C …» / «Изменить C2B …» → ввод процента 0–100; ошибка — сообщение; успех — **Удаление + Новое сообщение** (экран 10.1).

### 10.2. Новая группа

Экран с инструкцией (бот @RelloManagerBot, добавление, /start, токен регистрации). Кнопки: `Найти партнёров` (открыть группу с объявлениями) / `Клиенты вне сервиса`.

**Клиенты вне сервиса** → экран с получением токена:

- Rate‑limit: не более `{token_rate_limit}` в минуту; иначе **Системное уведомление**.
- Выдаём токен `{group_token}` на `{group_token_ttl_hours}` часа, **Новое сообщение** с токеном.
- Ожидаем ввода токена ботом @RelloGroupBot в группе; по истечении срока токен сгорает.

### 10.3. Мои группы

Список (пагинация по 10: «Название — B2C x% | C2B y%»). Карточка группы: проценты и действия `Изменить % комиссии` / `Удалить группу`.

- Изменить % → ввод и валидация (0–100), успех — **Удаление + Новое сообщение** карточки с обновлёнными значениями.
- Удалить группу → проверки: нет открытых сделок; баланс 0.00 RC. Иначе — системные уведомления. Успех — «Группа успешно удалена» + сообщение в саму группу от @RelloGroupBot.

---

## 11) Переписка «Написать пользователю»

Сообщения вне сделок — «незакреплённые», сообщения по сделке — входят в историю сделки. Отправка/получение **только** через @RelloClubBot.

- Получение: экран «Новое сообщение от пользователя: <профиль> (текст)» + кнопка `Ответить`.
-

Отправка: «Введите сообщение или отправьте .PDF/.JPG/.PNG до 10 МБ». Кнопка `Отменить`.

> 10 МБ → сообщение «Файл превышает 10 МБ».

- Неверный формат → «Принимаются только .PDF, .JPG, .PNG».
- Успех (текст/файл) → **Удаление + Новое сообщение** «Сообщение отправлено».

---

## 12) Запросы на чат‑группы из тем (@RelloTopicsBot)

**Отправитель**: пишет комментарий (до 200 символов; иначе сообщение об ошибке) → **Удаление + Новое сообщение** «Заявка отправлена». Дальше владелец объявления:

- `Написать пользователю` — переход к разделу 11.
- `Отказаться` — просьба ввести причину → закрытие заявки и уведомление отправителю.
- `Принять запрос` — формируем токен регистрации группы + инструкция (добавить пользователя, добавить @RelloManagerBot, /start, применить токен до 2 раз).

---

## 13) Профиль `/profile`

**Текст**

```
Мой профиль
Имя сервиса: {service_name}
```

**Кнопки:** `Язык сервиса` / `Изменить имя` / `Удалить аккаунт`\
**Режим вывода:** Редактирование

### 13.1. Изменить имя

Показать текущее имя и запросить новое ≤20 символов.\
— >20 → «Имя не должно превышать 20 символов».\
— Валидно → **Удаление + Новое сообщение** «Имя изменено успешно», затем автоматом показать «Мой профиль».

### 13.2. Удалить аккаунт

Подтверждение с условиями: закрыть сделки, вывести депозит/кошелёк, отсутствие открытых заявок. Каждое нарушение → **Системное уведомление** (с указанием причины). При соблюдении условий:

```
Аккаунт успешно удалён. Если захотите вернуться — обратитесь к участнику клуба Rello.
```

Деактивируем сервис и работников.\
**Режим вывода:** Редактирование

### 13.3. Язык сервиса `/lang`

```
Выберите язык сервиса
Установлено — {current_language}
```

**Кнопки:** `Назад` / `Русский` / `English`\
Выбор уже установленного → **Системное уведомление** «Данный язык уже установлен». Иначе — смена языка для всех ботов, **Системное уведомление** «Язык успешно изменён».

---

## 14) Сводка команд

- `/start` — вход/регистрация/восстановление *(Новое сообщение → далее меню)*
- `/menu` — главное меню *(Новое сообщение → навигация — Редактирование)*
- `/info` — инфо *(Новое сообщение)*
- `/office` — офис (услуги/работники/направление) *(Редактирование)*
- `/wallet` — кошелёк *(Редактирование)*
- `/rcoins` — операции с RC *(Редактирование → результат Новое сообщение)*
- `/bail` — депозит *(Редактирование → результат Новое сообщение)*
- `/referal` — реферальная программа *(Редактирование → CSV — Новое сообщение)*
- `/ads` `/addads` `/editads<id>` — объявления *(Редактирование; модерация/публикации — уведомления)*
- `/outjob` — чат‑группы *(Редактирование)*
- `/profile` `/lang` — профиль и язык *(Редактирование)*

---

## 15) Технические заметки

- Валидации всех пользовательских вводов: длина, формат, диапазоны, ISO 4217, адрес TRC20, URL блокчейна.
- После успешных шагов — **удаление старых экранов** + новое сообщение; fallback — снятие клавиатуры и «Уже не актуально».
- Лимиты/таймауты: токены (реф/группы), обновление/поднятие объявлений, подтверждения оплат (24 ч), SLA вывода депозита.
- Интеграции: @RelloDealBot (сделки/работники), @RelloAdminBot (обработка заявок), @RelloTopicsBot (публикации), @RelloGroupBot/@RelloManagerBot (чат‑группы), @RelloNoticeBot (уведомления), финансовое ядро (кошельки/AML/начисления/вывод).

> Готово к разработке и QA: полное флоу клиента, переменные, режимы вывода, правила актуальности и валидации.

