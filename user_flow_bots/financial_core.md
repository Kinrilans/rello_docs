# Rello — финансовое ядро системы

## Общее описание

Внутренняя самая главная система, отвечающая за обработку платежей реальными средствами USDT/USDC TRC20, а также обработку внутренней валюты Rello коинов. Финансовое ядро должно служить защищённым ядром по работе с финансами сервиса и отвечать всем мерам безопасности.

- Подключена к стороннему кошельку, который может создавать крипто-кошельки для сделок и переводить средства на основные крипто-кошельки.
- Подключена система AML‑проверки крипто-адресов для фильтрации средств с высоким риском.
- Внутренняя система для работы с **Rello Coin (RC)** — внутренней валютой, которая служит для совершения сделок и транзакций внутри сервиса (1:1 с USDT).

**Платформы и провайдеры:**

- Для работы с криптой используем платформу **CryptoCurrencyAPI**: https://new.cryptocurrencyapi.net
- Для AML‑проверок: https://getblock.net

---

## Описание функций

Проверяем запросы к ядру по системе безопасности — откуда, что и зачем; запрашивать может только наш бот со своими ключами доступа.

### 2.1. Основные кошельки Rello

- Создаём **10 основных кошельков**, куда будут сливаться «чистые» суммы после AML‑проверки.
- Создаём **1 кошелёк для грязных средств**, куда будут приходить остатки после возврата клиенту.

### 2.2. Пополнение кошелька RC коинов (по заявкам из @RelloClubBot и @RelloGroupBot)

1. Создаём отдельный кошелёк TRC20 под конкретную сделку и закрепляем за ним USDT/USDC, отправляем клиенту.
2. Ожидаем поступления средств.
3. Сумма поступила на кошелёк — проводим AML‑проверку крипто‑адреса и смотрим, какие пришли средства.
   - **Низкий уровень риска**:
     - Подтверждаем получение средств и отправляем их на один из основных кошельков.
   - **Высокий уровень риска**:
     - Отклоняем пополнение кошелька Rello коинами и отправляем уведомление с информацией по AML‑проверке.
     - Формируем обратный возврат на кошелёк отправителя с вычетом % комиссии за приход суммы с высоким риском, установленным в @RelloAdminBot.
     - Отправляем остатки на кошелёк для стока «грязных» монет.

### 2.3. Снятие с кошелька RC коинов (по заявкам из @RelloClubBot и @RelloGroupBot)

1. Проверяем возможность отправки суммы средств с одного из основных кошельков в желаемом токене USDT/USDC.
   - **Средств хватает**:
     - Отправляем средства в желаемой валюте на указанный крипто‑адрес.
     - Шлём уведомление, что сделка прошла успешно, и отдаём ссылку на блокчейн.
   - **Средств не хватает**:
     - Отправляем в другом токене, которого хватает, на указанный кошелёк.
     - Шлём уведомление об отправке средств в другом токене из-за отсутствия средств в желаемой валюте и отдаём ссылку на блокчейн.

### 2.4. Обработка сделок: передача RC‑токенов между клиентами (по заявкам из @RelloDealBot и @RelloGroupBot)

1. Замораживаем средства сделки в Rello коинах у первого пользователя.
2. Ожидаем подтверждения второго пользователя.
3. Отправляем замороженные средства пользователя один — второму пользователю.
4. Если сделка подана на арбитраж — ждём действий администратора.
   - **Администратор одобрил сделку** — отправляем замороженные средства пользователя один второму пользователю.
   - **Администратор отменил сделку** — размораживаем средства у первого пользователя обратно.
   - **Администратор разделил средства поровну** — отправляем половину замороженных средств второму пользователю, а половину размораживаем у первого.

### 2.5. Вывод прибыли сервиса

Сумма прибыли рассчитывается исходя из нашей комиссии за совершение сделок клиентами, пополнение и снятие Rello коинов.

- В боте администратора считается прибыль сервиса по процентам за совершённые сделки и пополнения/снятия.
- Раз в заданный период происходит перевод данной суммы с основных кошельков на указанный кошелёк в боте **@RelloOfficeBot**.
- Раз в заданный период происходит перевод данной суммы с основных кошельков на указанный кошелёк в боте **@RelloOfficeBot**.
- Заявка обрабатывается, и средства отправляются на указанный кошелёк.
- Отправляем уведомление в бот **@RelloOfficeBot** главному администратору (указанному в `.env`) со ссылкой на блокчейн‑транзакцию.

---

> Черновик перенесён из исходного файла. Готов к дальнейшей проработке и уточнениям.