# План запуска (pilot → go‑live) (v1)

Часовой пояс: **Europe/Warsaw**. Форматы: B2B, закрытый клуб. Активы: **USDT/USDC** (ERC‑20/TRC‑20). Основание: готовые документы — API, Webhooks, Deeplink/JWT, Engine выплат, Trust/EOD, Депозиты/лимиты, Админ‑консоль, Runbooks, Мониторинг, SOP кошельков, Backup/Restore, IRP (Incident Response Plan).

---

## 0) Цели запуска
- Безопасный **пилот** на ограниченной группе партнёров с доказанными SLO.  
- Минимально‑рисковый **go‑live** с канареечными кошельками и управляемой деградацией (safe‑mode).  
- Фиксация процессов: алерты, он‑колл, DR/Backup, арбитраж.

**Ключевые SLO на запуск:** p95 pass‑through ≤ 15 мин, p95 EOD ≤ 60 мин, webhooks ≥ 99%/15 мин окно.

---

## 1) Фазы и таймлайн
| Фаза | Период | Цели |
|---|---|---|
| **Pre‑flight** | T‑21…T‑14 | Среды, данные, кошельки, канарейки, алерты, бэкапы, UAT календарь |
| **Pilot** | T‑14…T‑7 | 2–4 партнёра, объём ≤10% дневной цели, обе сети, ежедневные EOD |
| **Canary Go‑Live** | T‑7…T‑1 | Расширение до 25–30% объёма, включены частичные T+1, отчёты SLO |
| **Full Go‑Live** | T0…T+7 | 100% объёма, стабильность, постмониторинг/улучшения |

> Даты подставляются в таблицу запуска, ориентируясь от планового **T0**.

---

## 2) Роли и коммуникации
- **Launch IC (Incident Commander запуска)** — ведёт план, решает блокеры.  
- **Comms Lead** — шаблоны/рассылки (RU/EN).  
- **Treasury Lead** — кошельки/ликвидность/EOD.  
- **DevOps Lead** — среды, RPC, бэкапы/DR.  
- **Risk/Arbiter Lead** — спорная политика, готовность арбитров.  
- **QA Lead** — тест‑план/Go‑No‑Go.  
- Каналы: `#launch‑prep`, `#launch‑warroom` (T‑1 → T+2).

---

## 3) Предпосылки (entry criteria)
- ✅ **Тест‑план (v1)** P0‑кейсы пройдены на **prod‑canary**; раздел 10 Go/No‑Go — «GO».  
- ✅ Мониторинг/алерты, Runbooks, IRP, Backup/Restore — активны.  
- ✅ SOP кошельков: канареечные кошельки, буферы газа/энергии, канареечные выплаты 1 USDT **зелёные**.  
- ✅ Terms/Privacy/MOU — согласован **черновик** для пилота; контакты эскалации партнёров подтверждены.

---

## 4) Онбординг пилотных партнёров
- Выбор 2–4 компаний (минимум по одному в tier S/M, желательно L).  
- Верификация кошельков/счетов; активация 2FA; назначение ролей **Admin/Trader/Approver**.  
- Создание 1–2 доверительных пар между пилотами, согласование `cut‑off` и TZ.  
- Тестовые сделки «малого номинала» в обеих сетях; проверка webhooks и интеграций.

---

## 5) Среды и данные
- **staging**: полная копия конфигов, фальш‑RPC; нагрузочные/реплей вебхуков.  
- **prod‑canary**: ограниченный доступ, канареечные кошельки, EOD в рабочем режиме.  
- Сидинг: 4 компании (S/M/L/XL), 2 пары Trust, депозиты, allow‑list адресов.

---

## 6) Freeze‑план
- **Code freeze**: T‑7 → T+2 (только hotfix по процедуре).  
- **Config freeze**: T‑3 → T+1 (исключение — cap per‑tx/fee‑mode по решению IC).  
- **Change window**: изменения только в **launch‑warroom** по шаблону (кто/что/когда/rollback).

---

## 7) Гардрейлы и объём
- Ограничения объёма: Pilot ≤10%, Canary ≤30% дневной цели.  
- Cap per‑tx: стандартные (ERC‑20 250k, TRC‑20 200k), при превышении — батчевание.  
- **Partial/T+1** разрешён начиная с Canary; при дефиците ликвидности применяем.

---

## 8) Cutover‑план (чек‑листы)
### T‑7 дней
- [ ] Go/No‑Go предварительный; дашборды и алерты — зелёные.  
- [ ] DR‑drill «сжатый» (DB PITR до T‑60 мин).  
- [ ] Резервы газа/TRX пополнены; min_hot_balance ≥ порогов.

### T‑3 дня
- [ ] Подтвердить `cut‑off` всех Trust‑пар и TZ.  
- [ ] Dry‑run `trust.session.close()` и `eod_settlement` на prod‑canary.  
- [ ] Ещё раз канареечные выплаты 1 USDT (обе сети).

### T‑1 день
- [ ] Подтвердить freeze‑режимы; напоминание партнёрам о расписании.  
- [ ] Проверка webhooks у партнёров; включена кнопка **replay**.  
- [ ] Баннер «запуск завтра» в @ClubGateBot (только пилотам).

### T‑2 часа
- [ ] Warroom открыт; роли в on‑call подтверждены.  
- [ ] Проверить очереди payout‑engine = 0; RPC health OK.  
- [ ] Отправить «старт через 2 часа» партнёрам.

### T‑30 минут
- [ ] Включить канареечные маршруты объёма (10→30%).  
- [ ] Проверить метрики p95 pass‑through/вебхуки за 30 мин окно.

### T0 (старт)
- [ ] Запуск Pilot/Canary по плану объёма.  
- [ ] Отслеживать stuck‑tx; при росте — политики speed‑up/fee‑mode.  
- [ ] В cut‑off: проверить EOD‑расчёты, частичные/T+1 при необходимости.

### T+1 час
- [ ] Отчёт Warroom: статус SLO, очереди, webhooks, инциденты.  
- [ ] Подтвердить канареечные выплаты и EOD первого окна.

### T+24 часа
- [ ] Ежедневный отчёт: SLO, объёмы, partial/T+1 %, баг‑лист.  
- [ ] Решение об увеличении объёма до полного (если Canary).

### T+7 дней
- [ ] Постмортем запуска (даже если без инцидентов): что улучшить, что автоматизировать.  
- [ ] Снятие freeze‑плана, переход в BAU (business‑as‑usual).

---

## 9) Коммуникации (RU/EN)
- Анонс пилота/канареек → только пилотам.  
- Статусы по EOD/partial/T+1 — шаблоны из Runbooks §11.  
- Инциденты — по IRP §8 (первый статус, апдейты, закрытие).  
- Вебхуки degraded — уведомление на EN с инструкцией по replay.

---

## 10) Критерии rollback
Rollback частичный (к сети/кошельку/объёму) или полный.
- p95 pass‑through > 30 мин 2 окна подряд **и** очередь растёт.  
- trust.eod_unsettled_sessions > 0 спустя 90 мин после cut‑off без улучшения.  
- webhooks success < 98% за 15 мин окно **и** dead‑letter растёт.  
- инцидент SEV1 (компрометация, БД, тотальная деградация RPC).

**Процедура:** объявить rollback в warroom → включить safe‑mode (EOD off/заморозка выплат по сети) → снизить объём до предыдущего уровня → сообщение партнёрам → RCA/фиксы → новая попытка.

---

## 11) KPI запуска
- Время «от T0 до 1‑го EOD settlement».  
- % partial/T+1 в EOD.  
- p95 pass‑through / p95 EOD.  
- % успешных вебхуков.  
- Кол‑во инцидентов (SEV1/2/3).  
- Конверсия оффер→сделка, отмены.

---

## 12) Артефакты запуска
- Чек‑листы по фазам (здесь).  
- Логи warroom (таймлайн/решения).  
- Отчёты SLO/объёмов.  
- Постмортем запуска с задачами.

---

## 13) Зависимости и ссылки
- Тест‑план (v1), Мониторинг/алерты (v1), Runbooks (v1), SOP кошельков (v1), Backup/Restore (v1), IRP (v1), Terms/Privacy/MOU (draft), Таблица tier’ов (v2).

---

## 14) To‑Do для подготовки к разработке/релизу
- Сверстать **таблицу дат** (T‑7…T+7) и назначить конкретные окна/ответственных.  
- Утвердить список **пилотных партнёров** и доверительных пар (лимиты/TZ/cut‑off).  
- Заполнить шаблоны **коммуникаций** (RU/EN) с контактами и расписанием апдейтов.  
- Завести **канареечные кошельки** и адреса‑проверки для всех сетей.  
- Подготовить **warroom** и on‑call расписание.  
- Проверить **freeze‑переключатели** в админ‑консоли.  
- Подготовить **отчётные дашборды** Grafana (Executive/Treasury/Trust/Webhooks).  
- Согласовать **rollback‑критерии** и шаблон решения.  
- Обновить **Мастер‑чеклист**: все документы готовы; остались тексты ботов (RU/EN) — опционально.

